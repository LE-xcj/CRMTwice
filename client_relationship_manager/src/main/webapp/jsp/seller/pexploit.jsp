<%@ page language="java" contentType="text/html; charset=UTF-8"
    pageEncoding="UTF-8"%>
<%@ taglib uri="http://java.sun.com/jsp/jstl/core" prefix="c" %>	
<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html>

	<head>
		<title>Glance Design Dashboard an Admin Panel Category Flat Bootstrap Responsive Website Template | Blank Page :: w3layouts</title>
		<meta name="viewport" content="width=device-width, initial-scale=1">
		<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
		<script type="application/x-javascript">
			addEventListener("load", function() { setTimeout(hideURLbar, 0); }, false);

			function hideURLbar() { window.scrollTo(0, 1); }
		</script>

		<!-- Bootstrap Core CSS -->
		<link href="${pageContext.request.contextPath }/css/bootstrap.css" rel='stylesheet' type='text/css' />

		<!-- Custom CSS -->
		<link href="${pageContext.request.contextPath }/css/bstyle.css" rel='stylesheet' type='text/css' />

		<!-- font-awesome icons CSS -->
		<link href="${pageContext.request.contextPath }/css/font-awesome.css" rel="stylesheet">
		<!-- //font-awesome icons CSS -->

		<!-- side nav css file -->
		<link href='${pageContext.request.contextPath }/css/SidebarNav.min.css' media='all' rel='stylesheet' type='text/css' />
		<!-- side nav css file -->

		<!-- js-->
		<script src="${pageContext.request.contextPath }/js/jquery-1.11.1.min.js"></script>
		<script src="${pageContext.request.contextPath }/js/modernizr.custom.js"></script>

		<!--webfonts-->
		<link href="//fonts.googleapis.com/css?family=PT+Sans:400,400i,700,700i&amp;subset=cyrillic,cyrillic-ext,latin-ext" rel="stylesheet">
		<!--//webfonts-->

		<!-- Metis Menu -->
		<script src="${pageContext.request.contextPath }/js/metisMenu.min.js"></script>
		<script src="${pageContext.request.contextPath }/js/custom.js"></script>
		<link href="${pageContext.request.contextPath }/css/custom.css" rel="stylesheet">
		<!--//Metis Menu -->
		
		
		<!-- echars 的网络资源 -->
       <script type="text/javascript" src="http://echarts.baidu.com/gallery/vendors/echarts/echarts.min.js"></script>
       <script type="text/javascript" src="http://echarts.baidu.com/gallery/vendors/echarts-gl/echarts-gl.min.js"></script>
       <script type="text/javascript" src="http://echarts.baidu.com/gallery/vendors/echarts-stat/ecStat.min.js"></script>
       <script type="text/javascript" src="http://echarts.baidu.com/gallery/vendors/echarts/extension/dataTool.min.js"></script>
       <script type="text/javascript" src="http://echarts.baidu.com/gallery/vendors/echarts/map/js/china.js"></script>
       <script type="text/javascript" src="http://echarts.baidu.com/gallery/vendors/echarts/map/js/world.js"></script>
       <script type="text/javascript" src="http://api.map.baidu.com/api?v=2.0&ak=ZUONbpqGBsYGXNIYHicvbAbM"></script>
       <script type="text/javascript" src="http://echarts.baidu.com/gallery/vendors/echarts/extension/bmap.min.js"></script>
       <script type="text/javascript" src="http://echarts.baidu.com/gallery/vendors/simplex.js"></script>
       
       <script type="text/javascript" src="/client_relationship_manager/js/zdialog.js"></script>
	   <link type="text/css" rel="stylesheet" href="/client_relationship_manager/css/zdialog.css">
	</head>

	<body class="cbp-spmenu-push">
		<div class="main-content">

			<!-- main content start-->
			<div id="page-wrapper" style="margin: 0 0 0 0;">

			<!-- echars -->
			<div
				class="col-md-6 content-top-2 charts-grids w3ls-high card agileits-high">
				<div id="container" style="height: 100%"></div>
			</div>
			
			<div class="clearfix"></div>

			<div class="charts">
	
					<div
						class="col-md-6 content-top-2 charts-grids w3ls-high card agileits-high">
	
						<div class="agileinfo-cdr">
							<div class="card-header">
								<h3>年度业绩</h3>
								<select id="year" name="year" onchange="getData(this.value);"></select>
							</div>
							<!-- start-chart -->
							<div class="content-graph">
								<!--graph-->
								<link rel="stylesheet"
									href="${pageContext.request.contextPath }/css/graph.css">
								<!--//graph-->
	
								<div class="graph-container">
	
									<div id="graph-lines" sytle="height:400px"></div>
								</div>
	
							</div>
						</div>
					</div>
	
					<div class="clearfix"></div>
				</div>
	
			<div class="table-responsive bs-example widget-shadow">
				<h4>完成订单</h4>
				<table class="table table-bordered">
					<thead>
						<tr>
							<td>序号</td>
							<td>单号</td>
							<td>金额</td>
							<td>创建时间</td>
							<td>客户姓名</td>
							<td>手机号</td>
						</tr>
					</thead>
					
					<tbody id="tb"></tbody>
					
					
				</table>
				
				<p>
					<button onclick="getBills(-1)">上一页</button> &nbsp&nbsp
					<label id="current">1</label>&nbsp&nbsp
					<button onclick="getBills(1)">下一页</button>
				</p>
			</div>
			
			</div>

		</div>

		<!--scrolling js-->
		<script src="${pageContext.request.contextPath }/js/jquery.nicescroll.js"></script>
		<script src="${pageContext.request.contextPath }/js/scripts.js"></script>
		<!--//scrolling js-->

		<!-- Bootstrap Core JavaScript -->
	<script src="${pageContext.request.contextPath }/js/bootstrap.js"></script>

	<!-- //graph script -->
	<script src="${pageContext.request.contextPath }/js/jquery.flot.js"></script>
	<script>
		
		$(document).ready(function(){
			getTD();
		});

		function getTD(){
			$.ajax({
				type:"post",
				url:"${pageContext.request.contextPath }/seller/getTimeDistance.action",
				success : function(data){
					makeSelectOption(data);
					getBills(0);
				}
			});
		}

		function makeSelectOption(data){
			console.info(data);
			var from = data.from;
			var to = data.to;

			var year_select = $("#year");
			for(var i=to; i>=from; --i){
				var op = $("<option></option>");
				op.val(i);
				op.text(i);
				op.appendTo(year_select);
			}

			getData(to);
		}

		<!--获取数据-->
		function getData(_year){
			console.info(_year);
			$.ajax({
				type:"post",
				data: {year: _year},
				url:"${pageContext.request.contextPath }/seller/getPersonlExploitForYear.action",
				success : function(data){
					makeLineForYear(data);
				}
			});
			$("#current").text("1");
			getBills(0);
		}

		<!--填充数据到折线图中-->
		function makeLineForYear(data) {

			// Graph Data ##############################################
			console.info(data);
			
 			var graphData = [
					{
						// Visits
						data : data.moneyPerMon,
/* 						data : [ [ 6, 1300 ], [ 7, 1600 ],
								[ 8, 1900 ], [ 9, 2100 ],
								[ 10, 2500 ], [ 11, 2200 ],
								[ 12, 2000 ], [ 13, 1950 ],
								[ 14, 1900 ], [ 15, 2000 ] ], */
						color : '#34bf49'
					},
					{
						// Returning Visits
						data : data.amountPerMon,
/* 						data : [ [ 6, 500 ], [ 7, 600 ],
								[ 8, 550 ], [ 9, 600 ],
								[ 10, 800 ], [ 11, 900 ],
								[ 12, 800 ], [ 13, 850 ],
								[ 14, 830 ], [ 15, 1000 ] ], */
						color : '#ff4c4c',
						points : {
							radius : 4,
							fillColor : '#fff'
						}
					} ]; 

			// Lines Graph #############################################
			$.plot($('#graph-lines'), graphData, {
				series : {
					points : {
						show : true,
						radius : 5
					},
					lines : {
						show : true
					},
					shadowSize : 0
				},
				grid : {
					color : '#7f8c8d',
					borderColor : 'transparent',
					borderWidth : 20,
					hoverable : true
				},
				xaxis : {
					tickColor : 'transparent',
					tickDecimals : 2
				},
				yaxis : {
					tickSize : 1000
				}
			});

			$('#lines').on('click', function(e) {
				$('#bars').removeClass('active');
				$('#graph-bars').fadeOut();
				$(this).addClass('active');
				$('#graph-lines').fadeIn();
				e.preventDefault();
			});

			// Tooltip #################################################
			function showTooltip(x, y, contents) {
				$('<div id="tooltip">' + contents + '</div>')
						.css({
							top : y - 16,
							left : x + 20
						}).appendTo('body').fadeIn();
			}

			var previousPoint = null;

			$('#graph-lines, #graph-bars').bind('plothover',
				function(event, pos, item) {
					if (item) {
						if (previousPoint != item.dataIndex) {
							previousPoint = item.dataIndex;
							$('#tooltip').remove();
							var x = item.datapoint[0], y = item.datapoint[1];
							showTooltip(
									item.pageX,
									item.pageY,
									x + '月利润: ' + y);
						}
					} else {
						$('#tooltip').remove();
						previousPoint = null;
					}
				});

		}
		
	</script>

	<!-- //graph script -->
	<!-- echars的客户满意度饼状图js -->
	<script type="text/javascript">

		$.ajax({
			type : "post",
			url : "${pageContext.request.contextPath }/seller/getSellStatue.action",
			async : true,
			success : function(data) {
				fillSellStatue(data);
			}
		});

		function fillSellStatue(data) {
			console.info(data);
			var dom = document.getElementById("container");
			var myChart = echarts.init(dom);
			var app = {};
			option = null;
			option = {
				title : {
					text : '销售情况',
					x : 'center'
				},
				tooltip : {
					trigger : 'item',
					formatter : "{a} <br/>{b} : {c} ({d}%)"
				},
				legend : {
					orient : 'vertical',
					left : 'left',
					data : data.name,
				},
				series : [ {
					name : '客户满意度',
					type : 'pie',
					radius : '55%',
					center : [ '50%', '60%' ],
					data : (function(){
						var res = [];
						var length = data.name.length;
						for(var i=0; i<length; ++i){
							res.push({
								name: data.name[i],
								value: data.value[i]
							});
						}
						
						return res;
					})(),
					itemStyle : {
						emphasis : {
							shadowBlur : 10,
							shadowOffsetX : 0,
							shadowColor : 'rgba(0, 0, 0, 0.5)'
						}
					}
				} ]
			};
			;
			if (option && typeof option === "object") {
				myChart.setOption(option, true);
			}
		}
	</script>

	<!-- 分页操作 -->
	<script type="text/javascript">
		function getBills(_num){
			var _size = 5;
			var _begin = $("#current").text();
			console.info(_begin);
			_begin = parseInt(_begin);
			_begin += _num;;

			var _year = $("#year option:selected").val();
			
			console.info("n_begin " + _begin + " year " + _year);
			if(_begin == 0){
				showDialog("已经是第一页了");
				return;
			}else{
				$.ajax({
		   			type:"post",
		   			url:"${pageContext.request.contextPath }/seller/getCompleteBill.action",
		   			data: {begin: _begin, size: _size, year: _year},
		   			async:true,
		   			success: function(data){
						console.info(data);
		   				fill(data, _begin);
			   			
		   			}
		   		});
			}
		}

		function fill(data, _begin){
			if(data.length == 0){
				showDialog("没有了");
			}else{
  				console.info("to fill");
				$("#current").text(_begin);
				var _tb = $("#tb");
				_tb.html("");

				for(var i=0; i<data.length; ++i){
					var _tr = $("<tr></tr>");
					$("<td></td>").text(i+1).appendTo(_tr);
					
					var _href = "/zhku/bill/html/" + data[i].bid + ".html";
					console.info(_href);
					var _a = $("<a></a>").attr("target", "_blank").attr("href", _href).text(data[i].bid);
					var _a_td = $("<td></td>");
					_a.appendTo(_a_td);
					_a_td.appendTo(_tr);
					//$("<td></td>").text(data[i].bid).appendTo(_tr);
					
					$("<td></td>").text(data[i].money).appendTo(_tr);
					$("<td></td>").text(data[i].createtime).appendTo(_tr);
					var cname = $("<td></td>");
					var phone = $("<td></td>");
					if(data[i].client == null){
						cname.text("无");
						phone.text("无");
					}else{
						cname.text(data[i].client.cname);
						phone.text(data[i].client.phone);
					}
					
					cname.appendTo(_tr);
					phone.appendTo(_tr);
					
					_tr.appendTo(_tb);
				}
			}
			

		}
	</script>
	
	
 	<script type="text/javascript">
		function showDialog(tip){
	
			$.DialogByZ.Alert({Title: "提示", Content: tip,BtnL:"确定",FunL:alerts});
		}
	
	    function alerts(){
		   
	    	  $.DialogByZ.Close();
	    }
 	</script>
</body>

</html>